\chapter[Основная часть]{ОСНОВНАЯ ЧАСТЬ}

\pics{1}{}
\pics{2}{}
\pics{3}{}
\pics{4}{}
\pics{4nop}{Без проекции;}
\pics{charts}{Диаграммы;}

\begin{lstlisting}[language=Python, caption=Код;]
    from dash import Dash, html, dcc
    import plotly.express as px
    import plotly.graph_objects as go
    import pandas as pd
    from clickhouse_driver import Client
    from queries import *
    
    client = Client('localhost')
    
    request1 = client.execute(query1)
    request2 = client.execute(query2)
    request3 = client.execute(query3)
    request4 = client.execute(query4)
    
    app = Dash(__name__)

    dt1 = {'year':[],
           'count':[],
           'sm':[]
           }
    
    for i in request1:
        dt1['year'].append(i[0])
        dt1['count'].append(i[1])
        dt1['sm'].append(i[2])
    df = pd.DataFrame(dt1)
    
    dt2 ={'town':[],
          'district':[],
          'count':[],
          'price':[],
          'sm':[]}
    for i in request2:
        dt2['town'].append(i[0])
        dt2['district'].append(i[1])
        dt2['count'].append(i[2])
        dt2['price'].append(i[3])
        dt2['sm'].append(i[4])
    df2 = pd.DataFrame(dt2)
    dt4 ={'town':[],
          'count':[],}
    for i in request4:
        dt4['town'].append(i[0])
        dt4['count'].append(i[1])
    df4 = pd.DataFrame(dt4)
    
    # print(df) ,projection='mercator'
    fig = px.bar(df, x="count", y="year", orientation='h', 
                 title='1. Average cost for each year')
    fig2 = px.bar(df2, x="price", y="district", orientation='h', 
                  title='2. Most expensive district ASC')
    fig4 = px.bar(df4, x="count", y="town", orientation='h', 
                  title='4. Count of districts for each town')
    df = pd.read_json('gb.json')
    fig5 = px.scatter_geo(df,
                        lat=df.lat,
                        lon=df.lng,
                        hover_name="city", 
                        center={'lat':55,'lon':-3}, 
                        title='5. Map',
                        projection='mercator')
    fig5.update_layout(margin={"r":0,"t":0,"l":0,"b":0})
    
    app.layout = html.Div(children=[
        html.H1(children='English is the Caiptal of Great Britain'),
        html.Div(children='''
        
        '''),
        dcc.Graph(
            id='first-gr',
            figure=fig
        ),
        html.Div(children='''
                
        '''),
        dcc.Graph(
        id='second-gr',
        figure=fig2
        ),
        html.B(children=f'''
        3. Longest district name: {request3[0][0]} - {request3[0][1]} characters!
        '''),
        html.Div(children='''
                
        '''),
        dcc.Graph(
        id='fourth-gr',
        figure=fig4
        ),
        dcc.Graph(id="graph",
                  figure=fig5),
        
    ])
    
    if __name__ == '__main__':
        app.run_server(debug=True, port=12891)
\end{lstlisting}